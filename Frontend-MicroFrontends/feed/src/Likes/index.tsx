import React, { useEffect, useState } from "react";
import { motion } from "framer-motion";

import { Container } from "./styles";

interface Props {
  id: number;
  likes: number;
}

const Likes: React.FC<Props> = ({ likes, id }) => {
  const [like, setLikes] = useState<number>(likes);
  const [liked, setLiked] = useState<boolean>(false);
  const [styleLike, setStyleLike] = useState<any>({});

  useEffect(() => {
    System.import("@monkeysmedia/util-module")
      .then((util) => util.apiPost("api/posts/check-like-post/", { id: id }))
      .then((resp) => {
        let respon = resp.data;
        if (respon[0] === "false") {
          setLiked(false);
        } else if (respon[0] === "true") {
          setLiked(true);
        }
      })
      .catch();
  }, [setLiked, id]);

  const handleClick = () => {
    // like and unlike request
    System.import("@monkeysmedia/util-module")
      .then((util) => util.apiPost("api/posts/like-unlike-posts/", { id: id }))
      .then((resp) => {
        if (resp.data.like === "Removed") {
          setLikes(like - 1);
          setLiked(false);
        } else if (resp.data.like === "Added") {
          setLikes(like + 1);
          setLiked(true);
        }
      })
      .catch();
  };

  const onTap = (e: any, info: any) => {
    if (liked) {
      setStyleLike({
        transition: "1s",
        color: "var(--primary)",
      });
    } else {
      setStyleLike({
        transition: "1s",
        color: "var(--shadow)",
      });
    }
  };

  return (
    <Container onClick={handleClick} liked={liked}>
      <div>
        <motion.div onTap={onTap}>
          <svg
            height="30px"
            viewBox="0 -91 512.00073 512"
            width="30px"
            style={styleLike}
          >
            <path d="m503.65625 165.609375c-5.300781-4.972656-12.503906-7.558594-19.75-7.09375-3.660156.234375-7.65625.488281-11.847656.75-5.082032.320313-10.085938 1.058594-15 2.160156 25-29.414062 43.125-64.59375 54.023437-104.996093 1.242188-4.605469 1.222657-9.515626-.050781-14.199219-1.941406-7.121094-6.75-13.125-13.199219-16.472657-6.371093-3.308593-13.59375-3.785156-20.332031-1.347656-3.359375 1.214844-7.023438 2.539063-10.871094 3.925782-11.332031 4.085937-21.664062 10.296874-30.710937 18.460937-50.679688 45.753906-103.847657 76.902344-158.015625 92.578125-51.476563 14.898438-98.796875 8.5625-140.644532-18.828125-30.835937-20.1875-53.132812-48.464844-67.234374-70.632813-2.425782-3.8125-4.515626-7.84375-6.039063-12.09375-1.539063-4.292968-3.78125-8.296874-6.648437-11.785156l-16.703126-20.347656c-2.78125-3.386719-6.882812-5.453125-11.261718-5.6679688-4.378906-.2187502-8.664063 1.4374998-11.761719 4.5390628l-13.042969 13.039062c-5.320312 5.324219-6.082031 13.65625-1.808594 19.820313 7.878907 11.367187 33.121094 50.539062 27.171876 77.316406-4.335938 19.515625-4.015626 42.949219.902343 65.980469 5.824219 27.289062 17.933594 52.972656 35.019531 74.269531 18.410157 22.949219 42.453126 40.992187 71.460938 53.621094 33.050781 14.390625 72.566406 21.6875 117.449219 21.6875 115.214843 0 200.480469-44.28125 253.414062-131.621094 2.5-4.121094 3.820313-8.890625 3.820313-13.792969 0-7.273437-3.039063-14.296875-8.339844-19.269531zm-21.054688-127.09375c2.753907-.996094 5.710938-.796875 8.320313.554687 2.78125 1.445313 4.78125 3.964844 5.636719 7.101563.566406 2.085937.582031 4.34375.039062 6.351563-.527344 1.964843-1.082031 3.910156-1.648437 5.847656l-16.992188-18.175782c1.597657-.578124 3.15625-1.140624 4.644531-1.679687zm-353.5625 94.582031c45.671876 29.894532 97.160157 36.855469 153.035157 20.6875 56.367187-16.3125 111.511719-48.5625 163.894531-95.851562 5.210938-4.703125 10.9375-8.613282 17.078125-11.722656l12.023437 12.863281c-2.640624 5.734375-5.472656 11.367187-8.472656 16.78125-1.972656 3.554687-.921875 8.175781 2.558594 10.277343 1.21875.734376 2.554688 1.082032 3.871094 1.082032 2.636718 0 5.191406-1.394532 6.5625-3.859375 2.257812-4.066407 4.421875-8.25 6.496094-12.5l3.574218 3.824219c-14.214844 39.636718-36.484375 73.191406-66.390625 99.972656-30.839843 13.738281-61.292969 23.875-91.144531 30.355468 55.585938-20.90625 99.253906-52.597656 130.050781-94.492187 2.253907-3.0625 2.011719-7.421875-.753906-10.03125-3.347656-3.160156-8.582031-2.597656-11.21875.996094-33.988281 46.3125-84.917969 79.546875-151.375 98.78125-22.40625 6.480469-43.988281 10.457031-64.222656 11.832031-2.441407.167969-4.894531.101562-7.320313-.207031-49.222656-6.238281-89.183594-29.765625-119.03125-70.183594-13.421875-18.175781-22.925781-37.335937-29.574218-54.257813 13.296874 16.019532 29.992187 32.316407 50.359374 45.652344zm-101.144531-83.558594c-4.902343-8.886718-9.726562-16.21875-12.808593-20.667968-.144532-.207032-.109376-.46875.085937-.667969l13.042969-13.039063c.042968-.042968.164062-.164062.386718-.164062h.035157c.246093.015625.363281.15625.402343.203125l16.207032 19.746094zm352.046875 242.804688c-36.082031 15.226562-78.199218 22.949219-125.179687 22.949219-42.808594 0-80.308594-6.875-111.457031-20.4375-26.757813-11.652344-48.878907-28.222657-65.75-49.253907-17.40625-21.699218-27.679688-46.46875-32.4375-69.988281 8.496093 19.976563 20.5 38.382813 35.472656 53.886719 18.933594 19.609375 42.566406 34.9375 70.25 45.5625 31.074218 11.925781 67.484375 17.972656 108.222656 17.972656 74.550781 0 137.167969-18.84375 186.109375-56.011718 3.300781-2.503907 3.945313-7.207032 1.441406-10.507813-2.507812-3.296875-7.210937-3.941406-10.511719-1.4375-46.273437 35.140625-105.839843 52.957031-177.039062 52.957031-73.496094 0-129.910156-19.835937-167.679688-58.953125-27.722656-28.710937-44.359374-68.292969-45.730468-108.707031.902344-12.648438-2.285156-27.472656-9.535156-44.207031-.417969-.964844-.84375-1.921875-1.277344-2.867188l16.640625-13.996093c4.132812 19.300781 15.941406 62.359374 44.703125 101.308593 17.113281 23.171875 37.703125 41.488281 61.207031 54.445313 28.320313 15.613281 61.082031 23.527344 97.371094 23.527344 60.289062 0 123.675781-15.675782 188.402343-46.589844 6.546876-3.128906 13.40625-5.320313 20.460938-6.597656l8.53125 15.878906c-4.199219 4.816406-8.566406 9.476562-13.039062 13.875-2.953126 2.902344-2.992188 7.652344-.085938 10.605468 1.46875 1.492188 3.40625 2.238282 5.347656 2.238282 1.898438 0 3.796875-.714844 5.257813-2.152344 3.425781-3.367188 6.789062-6.890625 10.078125-10.503906l2.699218 5.027344c-26.925781 37.070312-61.304687 64.601562-102.472656 81.976562zm115.410156-101.445312c-1.125 1.851562-2.265624 3.675781-3.421874 5.488281l-12.128907-22.578125c1.742188-.109375 3.441407-.21875 5.0625-.320313 3.183594-.203125 6.207031.882813 8.527344 3.0625 2.324219 2.179688 3.605469 5.136719 3.605469 8.332031 0 2.128907-.582032 4.261719-1.644532 6.015626zm0 0" />
          </svg>
        </motion.div>
        <h3>{like}</h3>
      </div>
    </Container>
  );
};

export default Likes;
